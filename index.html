<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feelin' Baggy Photobooth</title>
    <style>
        :root {
            --retro-pink: #ff71ce;
            --retro-blue: #01cdfe;
            --retro-dark: #2c5d63;
            --retro-cream: #f9f4e8;
            --booth-orange: #ff8c42;
        }

        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            background-color: #1a1a1a;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- SCREEN WRAPPERS --- */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: absolute;
        }

        .active { display: flex; }

        /* --- EXTERIOR VIEW --- */
        #screen-exterior {
            background: linear-gradient(var(--booth-orange), #d35400);
            border: 20px solid #222;
            box-sizing: border-box;
        }

        .booth-sign {
            background: #fff;
            padding: 20px 40px;
            border: 5px solid #333;
            font-size: 3rem;
            font-weight: bold;
            color: #333;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
            margin-bottom: 50px;
        }

        .curtain-door {
            width: 200px;
            height: 300px;
            background: repeating-linear-gradient(90deg, #800000, #800000 20px, #a00000 40px);
            border-radius: 10px 10px 0 0;
            border: 5px solid #222;
            position: relative;
        }

        /* --- INTERIOR VIEW --- */
        #screen-interior {
            background-color: #333;
            background-image: radial-gradient(#444 20%, transparent 20%);
            background-size: 20px 20px;
        }

        .monitor-frame {
            border: 15px solid #555;
            border-radius: 30px;
            padding: 20px;
            background: #222;
            box-shadow: inset 0 0 50px #000;
        }

        video {
            width: 400px;
            height: 300px;
            background: #000;
            transform: scaleX(-1);
            border: 2px solid var(--retro-blue);
        }

        /* --- RESULTS VIEW --- */
        #screen-results {
            background: #111;
        }

        /* The Animation */
        .falling-strip {
            animation: slideDown 1.5s ease-out forwards;
            background: var(--retro-cream);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
        }

        @keyframes slideDown {
            0% { transform: translateY(-1000px) rotate(-5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }

        .result-frame {
            width: 150px;
            height: 110px;
            border: 2px solid #333;
            background: #eee;
        }

        .result-frame img { width: 100%; height: 100%; object-fit: cover; }

        /* --- BUTTONS --- */
        .btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            background: var(--retro-pink);
            color: white;
            box-shadow: 4px 4px 0 var(--retro-blue);
        }

        .btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0 var(--retro-blue); }

        .logo-mid { width: 120px; display: block; margin: 5px auto; }
    </style>
</head>
<body>

    <div id="screen-exterior" class="screen active">
        <div class="booth-sign">PHOTOGRAPHS</div>
        <div class="curtain-door"></div>
        <button class="btn" onclick="goToInterior()">ENTER BOOTH</button>
    </div>

    <div id="screen-interior" class="screen">
        <div class="monitor-frame">
            <video id="video" autoplay playsinline></video>
        </div>
        <div style="color: white; margin-top: 10px;">SHOTS: <span id="count">0</span> / 4</div>
        <button id="snap-btn" class="btn" onclick="takePhoto()">SNAP PHOTO</button>
        <button id="done-btn" class="btn" style="display:none; background: var(--retro-blue);" onclick="goToResults()">FINISH & PRINT</button>
    </div>

    <div id="screen-results" class="screen">
        <div id="strip-container" class="falling-strip">
            <div class="result-frame" id="r1"></div>
            <div class="result-frame" id="r2"></div>
            <img src="logo.png" class="logo-mid" alt="Logo">
            <div class="result-frame" id="r3"></div>
            <div class="result-frame" id="r4"></div>
        </div>
        <div class="controls">
            <button class="btn" onclick="downloadStrip()">DOWNLOAD PNG</button>
            <button class="btn" style="background:#666;" onclick="location.reload()">RESTART</button>
        </div>
    </div>

    <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

    <script>
        let photoData = [];
        const video = document.getElementById('video');

        function goToInterior() {
            document.getElementById('screen-exterior').classList.remove('active');
            document.getElementById('screen-interior').classList.add('active');
            initWebcam();
        }

        async function initWebcam() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
            } catch (err) {
                alert("Please enable camera access!");
            }
        }

        function takePhoto() {
            if (photoData.length >= 4) return;

            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            // Mirror and draw
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            ctx.setTransform(1, 0, 0, 1, 0, 0);

            const data = canvas.toDataURL('image/png');
            photoData.push(data);
            
            // Update UI
            document.getElementById('count').innerText = photoData.length;
            
            // Flash effect
            video.style.opacity = 0;
            setTimeout(() => video.style.opacity = 1, 100);

            if (photoData.length === 4) {
                document.getElementById('snap-btn').style.display = 'none';
                document.getElementById('done-btn').style.display = 'inline-block';
            }
        }

        function goToResults() {
            document.getElementById('screen-interior').classList.remove('active');
            document.getElementById('screen-results').classList.add('active');
            
            // Fill the strip
            photoData.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                document.getElementById('r' + (index + 1)).appendChild(img);
            });
        }

        async function downloadStrip() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400;
            canvas.height = 1200;

            // Background
            ctx.fillStyle = "#f9f4e8";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const imgW = 360;
            const imgH = 240;
            const x = 20;

            for(let i=0; i<4; i++) {
                const img = new Image();
                img.src = photoData[i];
                await img.decode();
                let y = 20 + (i * (imgH + 20));
                if (i >= 2) y += 100; // Space for logo
                ctx.drawImage(img, x, y, imgW, imgH);
            }

            // Draw Logo
            const logo = new Image();
            logo.src = 'logo.png';
            try {
                await logo.decode();
                ctx.drawImage(logo, 100, 560, 200, 60);
            } catch(e) {}

            const link = document.createElement('a');
            link.download = 'baggy-strip.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>
