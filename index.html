<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feelin' Baggy â€¢ Auto Booth</title>
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00f3ff;
            --retro-yellow: #fff300;
            --baggy-teal: #2c5d63;
            --cream: #fefaf0;
        }

        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            font-family: 'Helvetica Neue', sans-serif;
            overflow: hidden;
            background-color: #1a1a1a;
            background-image: 
                radial-gradient(var(--neon-pink) 2px, transparent 2px),
                linear-gradient(45deg, transparent 48%, var(--neon-blue) 50%, transparent 52%);
            background-size: 40px 40px, 100px 100px;
        }

        .screen { display: none; flex-direction: column; align-items: center; width: 100%; height: 100%; position: absolute; justify-content: center; }
        .active { display: flex; animation: slideUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); }

        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        #screen-exterior {
            background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), 
                        repeating-linear-gradient(90deg, #1a1a1a, #1a1a1a 40px, #222 40px, #222 80px);
        }

        .hero-title {
            font-size: clamp(3rem, 12vw, 7rem);
            font-weight: 900;
            color: var(--retro-yellow);
            text-shadow: 4px 4px 0px var(--neon-pink), 8px 8px 0px var(--neon-blue);
            text-transform: uppercase;
            letter-spacing: -3px;
            margin-bottom: 20px;
            text-align: center;
            transform: rotate(-2deg);
        }

        #screen-interior {
            background: var(--baggy-teal);
            border: 20px solid #111;
            outline: 5px solid var(--neon-pink);
            box-shadow: inset 0 0 150px rgba(0,0,0,0.9);
        }

        .camera-ring {
            position: relative;
            padding: 12px;
            background: #000;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.4);
        }

        video { width: 520px; height: 390px; background: #000; transform: scaleX(-1); display: block; }

        /* COUNTDOWN OVERLAY */
        #timer-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            font-weight: 900;
            color: var(--retro-yellow);
            text-shadow: 0 0 20px var(--neon-pink);
            z-index: 100;
            pointer-events: none;
            display: none;
        }

        .strip-drop {
            background: var(--cream);
            padding: 15px;
            width: 200px;
            position: relative;
            box-shadow: 0 40px 80px rgba(0,0,0,0.9);
            animation: fallIn 1.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes fallIn { from { transform: translateY(-120%) rotate(-5deg); } to { transform: translateY(0) rotate(0deg); } }

        .photo-slot { width: 100%; height: 135px; background: #ddd; margin-bottom: 10px; overflow: hidden; }
        .photo-slot img { width: 100%; height: 100%; object-fit: cover; filter: contrast(1.1) brightness(1.1); }

        .watermark-logo {
            position: absolute; top: 48%; left: 50%;
            transform: translate(-50%, -50%) rotate(-5deg);
            width: 70px; z-index: 10;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
        }

        .btn-retro {
            background: var(--neon-pink); color: #fff; border: 4px solid #fff;
            padding: 15px 40px; font-size: 1.1rem; font-weight: 900;
            text-transform: uppercase; cursor: pointer;
            box-shadow: 6px 6px 0px var(--neon-blue); margin: 10px;
        }

        .flash { animation: flashAnim 0.2s ease-out; }
        @keyframes flashAnim { 0% { background: white; } 100% { background: transparent; } }

        .grain { position: fixed; top:0; left:0; width:100%; height:100%; background: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.15; pointer-events: none; z-index: 999; }
    </style>
</head>
<body>

    <div class="grain"></div>

    <div id="screen-exterior" class="screen active">
        <div class="hero-title">FEELIN'<br>BAGGY</div>
        <button class="btn-retro" onclick="startBooth()">Enter Booth</button>
    </div>

    <div id="screen-interior" class="screen">
        <div id="flash-div" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:200; pointer-events:none;"></div>
        <div class="camera-ring">
            <div id="timer-overlay">5</div>
            <video id="video" autoplay playsinline></video>
        </div>
        <div id="status-text" style="margin: 20px; color: var(--retro-yellow); font-weight:bold; letter-spacing:2px; height: 24px;">
            READY?
        </div>
        <button id="start-btn" class="btn-retro" onclick="startAutoSession()">START SESSION</button>
    </div>

    <div id="screen-results" class="screen">
        <div class="strip-drop" id="final-strip">
            <div class="photo-slot" id="s1"></div>
            <div class="photo-slot" id="s2"></div>
            <img src="Artboard 1@3x.png" class="watermark-logo" alt="Logo">
            <div class="photo-slot" id="s3"></div>
            <div class="photo-slot" id="s4"></div>
        </div>
        <button class="btn-retro" style="background: var(--neon-blue); margin-top:30px;" onclick="downloadStrip()">SAVE STRIP</button>
        <button class="btn-retro" style="background: #333;" onclick="location.reload()">RESTART</button>
    </div>

    <canvas id="hidden-canvas" width="600" height="450" style="display:none;"></canvas>

    <script>
        let photos = [];
        const video = document.getElementById('video');
        const timerOverlay = document.getElementById('timer-overlay');
        const statusText = document.getElementById('status-text');

        function startBooth() {
            document.getElementById('screen-exterior').classList.remove('active');
            document.getElementById('screen-interior').classList.add('active');
            navigator.mediaDevices.getUserMedia({ video: true }).then(s => video.srcObject = s);
        }

        async function startAutoSession() {
            document.getElementById('start-btn').style.display = 'none';
            photos = [];
            
            for (let i = 1; i <= 4; i++) {
                await runCountdown(5, i);
                capturePhoto(i);
            }
            
            statusText.innerText = "PRINTING...";
            setTimeout(() => {
                document.getElementById('screen-interior').classList.remove('active');
                document.getElementById('screen-results').classList.add('active');
            }, 1000);
        }

        function runCountdown(seconds, photoNum) {
            return new Promise(resolve => {
                let count = seconds;
                timerOverlay.style.display = 'block';
                timerOverlay.innerText = count;
                statusText.innerText = `GET READY FOR PHOTO ${photoNum}/4`;

                const interval = setInterval(() => {
                    count--;
                    if (count <= 0) {
                        clearInterval(interval);
                        timerOverlay.style.display = 'none';
                        resolve();
                    } else {
                        timerOverlay.innerText = count;
                    }
                }, 1000);
            });
        }

        function capturePhoto(index) {
            const canvas = document.getElementById('hidden-canvas');
            const ctx = canvas.getContext('2d');
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            ctx.setTransform(1, 0, 0, 1, 0, 0);

            const data = canvas.toDataURL('image/png');
            photos.push(data);
            document.getElementById('s' + index).innerHTML = `<img src="${data}">`;
            
            // Visual Flash
            const flash = document.getElementById('flash-div');
            flash.classList.remove('flash');
            void flash.offsetWidth; // Trigger reflow
            flash.classList.add('flash');
        }

        async function downloadStrip() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400; canvas.height = 1100;
            ctx.fillStyle = "#fefaf0";
            ctx.fillRect(0,0,400,1100);

            for(let i=0; i<4; i++) {
                const img = new Image();
                img.src = photos[i];
                await img.decode();
                ctx.drawImage(img, 20, 20 + (i * 265), 360, 250);
            }

            const logo = new Image();
            logo.src = 'Artboard 1@3x.png';
            try {
                await logo.decode();
                ctx.save();
                ctx.translate(200, 550);
                ctx.rotate(-0.1);
                ctx.drawImage(logo, -60, -35, 120, 70);
                ctx.restore();
            } catch(e){}

            const link = document.createElement('a');
            link.download = 'feelin-baggy-strip.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>
